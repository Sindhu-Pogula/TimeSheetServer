@model TimeSheet.Models.Timesheet

<h2>Edit Timesheet</h2>

<form asp-action="Edit" method="post">

    <input type="hidden" asp-for="Id" />

    <div class="form-group">
        <label asp-for="FromDate"></label>
        <input asp-for="FromDate" class="form-control" type="date" />
    </div>

    <div class="form-group">
        <label asp-for="ToDate"></label>
        <input asp-for="ToDate" class="form-control" type="date" />
    </div>

    <div class="form-group">
        <label asp-for="Project"></label>
        <input asp-for="Project" class="form-control" />
    </div>

    <!-- Input fields for Monday to Sunday with class 'day-hours' -->
    <div class="form-group">
        <label asp-for="Monday"></label>
        <input asp-for="Monday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <div class="form-group">
        <label asp-for="Tuesday"></label>
        <input asp-for="Tuesday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <div class="form-group">
        <label asp-for="Wednesday"></label>
        <input asp-for="Wednesday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <div class="form-group">
        <label asp-for="Thursday"></label>
        <input asp-for="Thursday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <div class="form-group">
        <label asp-for="Friday"></label>
        <input asp-for="Friday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <div class="form-group">
        <label asp-for="Saturday"></label>
        <input asp-for="Saturday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <div class="form-group">
        <label asp-for="Sunday"></label>
        <input asp-for="Sunday" class="form-control day-hours" type="number" min="0" step="0.01" />
    </div>

    <!-- TotalHours field which will be auto-updated -->
    <div class="form-group">
        <label asp-for="TotalHours"></label>
        <input asp-for="TotalHours" class="form-control" id="TotalHours" readonly />
    </div>

<button type="submit" class="btn btn-primary" onclick="handleSaveChanges()">Save Changes</button>

</form>
<script>
    function handleSaveChanges(event) {
        // Example: Perform some client-side logic (e.g., calculate total hours)
        updateTotalHours();

        // Show a confirmation message before submission
        const confirmed = confirm("Are you sure you want to save the changes?");
        
        if (!confirmed) {
            // Prevent form submission if not confirmed
            event.preventDefault();
            return false;
        }

        // Optionally, if the form passes all validations, you can submit the form manually
        // and then redirect to the History page
        // If you're using an AJAX call, you could handle the redirection after a successful request.
        
        // Assuming the form submission is successful, redirect to the History page
        window.location.href = "/Timesheet/History";  // This is where you want to redirect
    }

    function updateTotalHours() {
        let total = 0;

        // Calculate total hours from the input fields
        const dayFields = document.querySelectorAll('.day-hours');
        dayFields.forEach(function (input) {
            let value = parseFloat(input.value) || 0;
            total += value;
        });

        // Update the TotalHours field with the calculated total
        document.getElementById('TotalHours').value = total.toFixed(2);
    }
</script>

<script>
    // Function to update the TotalHours field
    function updateTotalHours() {
        let total = 0;

        // Get all elements with the class 'day-hours' (Monday to Sunday fields)
        const dayFields = document.querySelectorAll('.day-hours');

        // Loop through each day input and add the value to the total
        dayFields.forEach(function (input) {
            let value = parseFloat(input.value) || 0; // Use 0 if input is empty or invalid
            total += value;
        });

        // Set the total hours to the TotalHours input field
        document.getElementById('TotalHours').value = total.toFixed(2); // Show total with 2 decimal points
    }

    // Attach the updateTotalHours function to each day-hours input field
    document.querySelectorAll('.day-hours').forEach(function (input) {
        input.addEventListener('input', updateTotalHours);
    });

    // Trigger initial calculation on page load in case there are pre-filled values
    document.addEventListener('DOMContentLoaded', updateTotalHours);
</script>
